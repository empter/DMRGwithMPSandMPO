(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    127768,       2973]
NotebookOptionsPosition[    126817,       2935]
NotebookOutlinePosition[    127205,       2952]
CellTagsIndexPosition[    127162,       2949]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Define MPO and Ham", "Title",
 CellChangeTimes->{{3.6721947276067944`*^9, 3.6721947460553493`*^9}, {
  3.672195039706378*^9, 3.672195051235914*^9}, {3.672195151903777*^9, 
  3.672195155276739*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"n", "=", "1"}], ",", 
    RowBox[{
     RowBox[{"return", " ", "W_", "1"}], ";", " ", 
     RowBox[{"n", "=", "NN"}]}], ",", " ", 
    RowBox[{
     RowBox[{"return", " ", "W_N"}], ";", " ", 
     RowBox[{"otherwise", " ", "return", " ", "W_i"}]}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"isingMPO", "[", 
      RowBox[{"h_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sx", ",", "sy", ",", "sz", ",", "si", ",", "W"}], "}"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sx", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "1."}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1.", ",", "0"}], "}"}]}], "}"}], "/", "2"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sy", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1."}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1.", ",", "0"}], "}"}]}], "}"}], "/", "2"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sz", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1.", ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1."}]}], "}"}]}], "}"}], "/", "2"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"si", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1.", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1."}], "}"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"n", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"W", "=", 
            RowBox[{"Table", "[", 
             RowBox[{"0", ",", 
              RowBox[{"{", "1", "}"}], ",", 
              RowBox[{"{", "3", "}"}], ",", 
              RowBox[{"{", "2", "}"}], ",", 
              RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{
            RowBox[{"W", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"-", "h"}], " ", "sz"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"W", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}], "=", "sx"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"W", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3"}], "]"}], "]"}], "=", "si"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", "\[Equal]", "NN"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"W", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0", ",", 
                RowBox[{"{", "3", "}"}], ",", 
                RowBox[{"{", "1", "}"}], ",", 
                RowBox[{"{", "2", "}"}], ",", 
                RowBox[{"{", "2", "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "=", "si"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], "=", 
              RowBox[{
               RowBox[{"-", "J"}], " ", "sx"}]}], ";", "\[IndentingNewLine]", 
             
             RowBox[{
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "1"}], "]"}], "]"}], "=", 
              RowBox[{
               RowBox[{"-", "h"}], " ", "sz"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"W", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0", ",", 
                RowBox[{"{", "3", "}"}], ",", 
                RowBox[{"{", "3", "}"}], ",", 
                RowBox[{"{", "2", "}"}], ",", 
                RowBox[{"{", "2", "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "=", "si"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}], "=", 
              RowBox[{
               RowBox[{"-", "J"}], " ", "sx"}]}], ";", "\[IndentingNewLine]", 
             
             RowBox[{
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "1"}], "]"}], "]"}], "=", 
              RowBox[{
               RowBox[{"-", "h"}], " ", "sz"}]}], ";", "\[IndentingNewLine]", 
             
             RowBox[{
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "2"}], "]"}], "]"}], "=", "sx"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "3"}], "]"}], "]"}], "=", "si"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "W", "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"for", " ", "iDMRG"}], ",", " ", 
     RowBox[{
      RowBox[{"return", " ", "a", " ", "N"}], "=", 
      RowBox[{"2", " ", "Ham"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"isingh1", "[", "h_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sx", ",", "sy", ",", "sz", ",", "si"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sx", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "1."}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1.", ",", "0"}], "}"}]}], "}"}], "/", "2"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sy", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1."}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1.", ",", "0"}], "}"}]}], "}"}], "/", "2"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sz", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1.", ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1."}]}], "}"}]}], "}"}], "/", "2"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"si", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1.", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1."}], "}"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "J"}], " ", 
           RowBox[{"KroneckerProduct", "[", 
            RowBox[{"sx", ",", "sx"}], "]"}]}], "-", 
          RowBox[{"h", " ", 
           RowBox[{"KroneckerProduct", "[", 
            RowBox[{"sz", ",", "si"}], "]"}]}], "-", 
          RowBox[{"h", " ", 
           RowBox[{"KroneckerProduct", "[", 
            RowBox[{"si", ",", "sz"}], "]"}]}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"setup", " ", "a", " ", "random", " ", "MPS"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"randomMPS", "[", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "mps", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"mps", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"RandomReal", "[", "]"}], ",", 
           RowBox[{"{", "NN", "}"}], ",", 
           RowBox[{"{", "d", "}"}], ",", 
           RowBox[{"{", "DD", "}"}], ",", 
           RowBox[{"{", "DD", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mps", "[", 
          RowBox[{"[", "NN", "]"}], "]"}], "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"RandomReal", "[", "]"}], ",", 
           RowBox[{"{", "d", "}"}], ",", 
           RowBox[{"{", "DD", "}"}], ",", 
           RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mps", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"RandomReal", "[", "]"}], ",", 
           RowBox[{"{", "d", "}"}], ",", 
           RowBox[{"{", "1", "}"}], ",", 
           RowBox[{"{", "DD", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "mps", "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "bring", " ", "the", " ", "random", " ", "MPS", " ", "into", " ", "right",
      " ", "normalized", " ", "form"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"rightNormalize", "[", "mps_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "Bs", ",", "dleft", ",", "dright", ",", "mmatrix", ",", "U", ",", "S",
          ",", "V", ",", "dimS", ",", "mu", ",", "norm"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Bs", "=", "mps"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"dleft", "=", 
            RowBox[{
             RowBox[{"Dimensions", "[", 
              RowBox[{"Bs", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"dright", "=", 
            RowBox[{
             RowBox[{"Dimensions", "[", 
              RowBox[{"Bs", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"mmatrix", "=", 
            RowBox[{"ArrayReshape", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{"Bs", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"dleft", ",", 
                RowBox[{"dright", " ", "d"}]}], "}"}]}], "]"}]}], ";", 
           RowBox[{"(*", 
            RowBox[{
            "transpose", " ", "the", " ", "first", " ", "two", " ", "index"}],
             "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"U", ",", "S", ",", "V"}], "}"}], "=", 
            RowBox[{"SingularValueDecomposition", "[", 
             RowBox[{"mmatrix", ",", 
              RowBox[{"Min", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Dimensions", "[", "mmatrix", "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", "DD"}], "]"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"dimS", "=", 
            RowBox[{
             RowBox[{"Dimensions", "[", "S", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Bs", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"Transpose", "[", 
             RowBox[{"ArrayReshape", "[", 
              RowBox[{
               RowBox[{"V", "\[HermitianConjugate]"}], ",", 
               RowBox[{"{", 
                RowBox[{"dimS", ",", "d", ",", "dright"}], "}"}]}], "]"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"mu", "=", 
            RowBox[{"Activate", " ", "@", " ", 
             RowBox[{"TensorContract", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                RowBox[{
                 RowBox[{"Bs", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "-", "1"}], "]"}], "]"}], ",", "U"}], "]"}], 
               ",", 
               RowBox[{"{", 
                RowBox[{"3", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Bs", "[", 
             RowBox[{"[", 
              RowBox[{"i", "-", "1"}], "]"}], "]"}], "=", 
            RowBox[{"Activate", " ", "@", " ", 
             RowBox[{"TensorContract", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                RowBox[{"mu", ",", "S"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"3", ",", "4"}], "}"}]}], "]"}]}]}]}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "NN", ",", "2", ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"norm", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Bs", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], ".", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Bs", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"Bs", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}], ".", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Bs", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"norm", "=", 
           RowBox[{"{", 
            RowBox[{"{", "1", "}"}], "}"}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Bs", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{"Bs", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "/", 
          RowBox[{"\[Sqrt]", 
           RowBox[{"norm", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "Bs", "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.671872240009959*^9, 3.671872361816608*^9}, {
   3.671872459716436*^9, 3.671872636138402*^9}, {3.671872684032453*^9, 
   3.671872689453114*^9}, 3.6718728348959503`*^9, {3.671872894835883*^9, 
   3.671872962412747*^9}, {3.671873002498241*^9, 3.6718732607011414`*^9}, 
   3.671873331811512*^9, {3.671873653113406*^9, 3.671873690573182*^9}, {
   3.6718737798207417`*^9, 3.671873780370986*^9}, {3.671873873295456*^9, 
   3.671873877489592*^9}, {3.671874681004578*^9, 3.671874781936907*^9}, {
   3.6718748253732967`*^9, 3.671874914102984*^9}, {3.6718750038240423`*^9, 
   3.671875020664938*^9}, {3.671875081483942*^9, 3.6718750847392473`*^9}, {
   3.671875234707665*^9, 3.671875345376492*^9}, {3.671875583357966*^9, 
   3.671875605011978*^9}, {3.671875653153388*^9, 3.671875764337399*^9}, {
   3.671876101612831*^9, 3.67187616349794*^9}, {3.671876283638689*^9, 
   3.671876316093904*^9}, {3.671876348742753*^9, 3.671876377564081*^9}, {
   3.671876465922003*^9, 3.671876476261669*^9}, {3.671878153960145*^9, 
   3.67187815459762*^9}, {3.6718783820187683`*^9, 3.671878406542407*^9}, {
   3.671878557710678*^9, 3.671878557991274*^9}, {3.671878691642964*^9, 
   3.671878713973947*^9}, {3.671879107398672*^9, 3.671879207884371*^9}, {
   3.6718792589706287`*^9, 3.671879275121347*^9}, {3.671879436382832*^9, 
   3.671879440893117*^9}, {3.6718794848163958`*^9, 3.671879528363277*^9}, {
   3.671879606810643*^9, 3.6718796488502607`*^9}, {3.6718807618410807`*^9, 
   3.671880810619358*^9}, {3.671880897742263*^9, 3.671880966827841*^9}, {
   3.671881001815584*^9, 3.6718810518654623`*^9}, {3.6718812230137568`*^9, 
   3.6718812313711977`*^9}, {3.671881299708496*^9, 3.671881341902845*^9}, {
   3.6718815472759438`*^9, 3.67188162508932*^9}, {3.67188193965415*^9, 
   3.6718820339735203`*^9}, {3.67188288415539*^9, 3.671882908952615*^9}, {
   3.671883087721589*^9, 3.671883089991887*^9}, {3.6718841229716787`*^9, 
   3.671884134961932*^9}, 3.671884174250924*^9, {3.671884555051977*^9, 
   3.671884569325679*^9}, {3.671916144777566*^9, 3.671916174356975*^9}, {
   3.671916247143765*^9, 3.671916259194214*^9}, {3.6719193024187098`*^9, 
   3.671919317798794*^9}, {3.671919700537166*^9, 3.671919734180121*^9}, {
   3.671919768313623*^9, 3.671919798983676*^9}, {3.671919896306435*^9, 
   3.671919937597991*^9}, {3.6719205307838583`*^9, 3.6719205395626993`*^9}, {
   3.671920575449615*^9, 3.6719205782756643`*^9}, {3.671920665495346*^9, 
   3.671920688902828*^9}, {3.6719209619946737`*^9, 3.671921082519762*^9}, {
   3.671921131815104*^9, 3.671921223894329*^9}, {3.671921297556507*^9, 
   3.671921338063335*^9}, {3.671921404856615*^9, 3.671921434213498*^9}, {
   3.671921484003187*^9, 3.6719214884691668`*^9}, {3.6719219397189703`*^9, 
   3.671921995080303*^9}, {3.6719220424370527`*^9, 3.6719220764973497`*^9}, {
   3.671922778868531*^9, 3.671922783256845*^9}, {3.671922885252071*^9, 
   3.671923007505454*^9}, {3.671923126459589*^9, 3.671923132647586*^9}, {
   3.67192322132016*^9, 3.6719232892395372`*^9}, {3.6719234038544064`*^9, 
   3.671923415632306*^9}, {3.671923473298813*^9, 3.671923491694995*^9}, {
   3.6719235291105633`*^9, 3.671923529356427*^9}, {3.671923583815721*^9, 
   3.6719235988014*^9}, 3.671923648393827*^9, {3.671923688791338*^9, 
   3.671923731622285*^9}, {3.671923951483541*^9, 3.6719239577312593`*^9}, {
   3.671924001742486*^9, 3.6719240531934357`*^9}, {3.671924114493046*^9, 
   3.671924115051153*^9}, {3.671924346465885*^9, 3.671924373014655*^9}, {
   3.671924563408886*^9, 3.6719246112106*^9}, {3.671924645242898*^9, 
   3.6719247170860157`*^9}, {3.671924932881877*^9, 3.671925074741542*^9}, {
   3.6719251309710493`*^9, 3.671925140946101*^9}, {3.671925242141214*^9, 
   3.671925285497488*^9}, {3.6719253423743563`*^9, 3.671925345777122*^9}, {
   3.6719254131279182`*^9, 3.671925471290498*^9}, {3.6719255755944567`*^9, 
   3.671925594427335*^9}, {3.67192586325482*^9, 3.671925956511215*^9}, {
   3.671926072781876*^9, 3.671926084815366*^9}, {3.6719262642873583`*^9, 
   3.671926330503335*^9}, {3.67192636469627*^9, 3.671926364899098*^9}, {
   3.6719264497546864`*^9, 3.6719265546570587`*^9}, {3.671926591734399*^9, 
   3.671926614596632*^9}, {3.671926685859552*^9, 3.671926714251741*^9}, {
   3.6719267623039227`*^9, 3.6719267966963177`*^9}, 3.671926851789751*^9, {
   3.671926956401599*^9, 3.6719270431864853`*^9}, {3.671927213327321*^9, 
   3.6719272863714523`*^9}, {3.671927340959155*^9, 3.67192744755882*^9}, 
   3.671927489201169*^9, {3.671927596259966*^9, 3.6719276637626123`*^9}, {
   3.6719277484913063`*^9, 3.671927775360773*^9}, {3.6719278400595217`*^9, 
   3.671928002655373*^9}, {3.6719280598029547`*^9, 3.671928072821004*^9}, {
   3.671928144158731*^9, 3.671928186794928*^9}, {3.67192828212171*^9, 
   3.671928344427712*^9}, {3.67192840050005*^9, 3.671928460918529*^9}, {
   3.671928540402527*^9, 3.671928575760963*^9}, {3.671931284317031*^9, 
   3.671931545800042*^9}, {3.671931599576496*^9, 3.6719316521696463`*^9}, {
   3.671931697529708*^9, 3.671931826658366*^9}, {3.671931894936035*^9, 
   3.6719319908302383`*^9}, {3.671932025830764*^9, 3.671932171494997*^9}, {
   3.671932395382926*^9, 3.671932436489457*^9}, {3.671932479655882*^9, 
   3.6719326097297688`*^9}, {3.67193265464224*^9, 3.671932770189343*^9}, {
   3.6719328509894753`*^9, 3.671932897786936*^9}, {3.671932953329995*^9, 
   3.67193297502997*^9}, {3.6719330364339323`*^9, 3.671933170456135*^9}, {
   3.671933228011537*^9, 3.671933269751642*^9}, 3.6719333011442738`*^9, {
   3.671933332425919*^9, 3.671933344100731*^9}, {3.6719333897453527`*^9, 
   3.671933610106927*^9}, {3.6719336408970423`*^9, 3.671933668735875*^9}, {
   3.671933840520912*^9, 3.671933852613203*^9}, {3.671933946273649*^9, 
   3.6719339513214912`*^9}, {3.671934071082848*^9, 3.671934147455841*^9}, {
   3.671934238178706*^9, 3.671934291198516*^9}, {3.671934742924697*^9, 
   3.671934766053071*^9}, {3.671934920696494*^9, 3.671934929356975*^9}, {
   3.671934977745002*^9, 3.671934979104459*^9}, {3.671935139872707*^9, 
   3.671935159014686*^9}, {3.6719353458305893`*^9, 3.67193534601687*^9}, {
   3.671935376334687*^9, 3.67193540654932*^9}, {3.6719356165000668`*^9, 
   3.671935616783187*^9}, {3.671935788205909*^9, 3.6719357949781227`*^9}, {
   3.671935903961402*^9, 3.671935928045035*^9}, {3.6719359761191874`*^9, 
   3.671935986907095*^9}, {3.671936022230197*^9, 3.671936029542375*^9}, {
   3.671936097642302*^9, 3.671936097932704*^9}, {3.671938409907001*^9, 
   3.6719384145628433`*^9}, {3.6719386700097637`*^9, 3.671938673054886*^9}, 
   3.671939096524664*^9, {3.671939602455332*^9, 3.671939637996853*^9}, {
   3.671944478773654*^9, 3.6719444922611847`*^9}, {3.671944755362136*^9, 
   3.6719447660740347`*^9}, 3.671945665719719*^9, {3.6719457494142*^9, 
   3.6719457570704203`*^9}, {3.671945911366987*^9, 3.6719459127938757`*^9}, {
   3.671945957480001*^9, 3.671945974388576*^9}, {3.671946251099312*^9, 
   3.671946251473493*^9}, {3.67195242877286*^9, 3.671952463045824*^9}, {
   3.671952567602418*^9, 3.671952601496616*^9}, {3.6719526910496063`*^9, 
   3.6719526956383657`*^9}, 3.671953049407165*^9, {3.672005804461063*^9, 
   3.6720058154084587`*^9}, {3.672005892155488*^9, 3.6720059168450403`*^9}, {
   3.672023102522181*^9, 3.672023105037621*^9}, {3.672023207811676*^9, 
   3.672023208428302*^9}, {3.6720297241069307`*^9, 3.672029726602695*^9}, {
   3.672029778818694*^9, 3.67202991902323*^9}, {3.672029951068501*^9, 
   3.6720302075207148`*^9}, {3.672030247266386*^9, 3.672030397533607*^9}, {
   3.672030457136818*^9, 3.6720305284275846`*^9}, {3.6720305607621403`*^9, 
   3.6720306304548273`*^9}, {3.672030687368887*^9, 3.6720308019513702`*^9}, {
   3.672030848976544*^9, 3.672030892280938*^9}, {3.672030972987732*^9, 
   3.672031128677198*^9}, {3.6720311642733393`*^9, 3.6720313398908052`*^9}, {
   3.672031424151629*^9, 3.672031424431101*^9}, 3.672031613628221*^9, {
   3.672031672846127*^9, 3.672031676615861*^9}, {3.672031722582747*^9, 
   3.6720317276126966`*^9}, {3.672031774875732*^9, 3.672031792805798*^9}, {
   3.672031985024914*^9, 3.6720321748278427`*^9}, {3.6720322253746758`*^9, 
   3.67203240410345*^9}, {3.672032834757989*^9, 3.6720328349563417`*^9}, {
   3.6720328907247257`*^9, 3.672033061178508*^9}, {3.672033098022781*^9, 
   3.6720331761955347`*^9}, 3.672033383899631*^9, 3.672033432478889*^9, {
   3.67203350724716*^9, 3.6720335106550493`*^9}, {3.67203391299229*^9, 
   3.672033915467064*^9}, {3.6720365000615053`*^9, 3.67203650751853*^9}, {
   3.672036549775351*^9, 3.6720368381371393`*^9}, 3.672036945096218*^9, 
   3.672036976742996*^9, {3.672037290411686*^9, 3.672037296104525*^9}, {
   3.6721859742859592`*^9, 3.672185981631205*^9}, {3.672186056590312*^9, 
   3.672186100194584*^9}, {3.672186135329111*^9, 3.672186170441902*^9}, {
   3.672186366576733*^9, 3.672186367183056*^9}, {3.672186482328238*^9, 
   3.672186482439777*^9}, {3.672186539874524*^9, 3.672186543944117*^9}, {
   3.672186632205886*^9, 3.6721866325853863`*^9}, 3.6721947754595623`*^9, {
   3.672194976800557*^9, 3.672195026311079*^9}, {3.672352520626038*^9, 
   3.672352522551251*^9}, {3.674082924061392*^9, 3.6740829352758474`*^9}, 
   3.674083018970276*^9, {3.674213391240505*^9, 3.6742134298873143`*^9}, {
   3.6747733060956345`*^9, 3.6747733298863797`*^9}, 3.674773363409148*^9, {
   3.674773516955612*^9, 3.674773537281169*^9}, {3.6747735687090034`*^9, 
   3.6747736104450684`*^9}, {3.6749695402533092`*^9, 3.674969556436365*^9}, {
   3.674969618996402*^9, 3.6749696214856634`*^9}, {3.714642954038866*^9, 
   3.714642966851619*^9}, {3.750377772589797*^9, 3.750378000824929*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["MPS Function Main Part", "Title",
 CellChangeTimes->{{3.6721948002936783`*^9, 3.672194804263299*^9}, {
  3.6721957739423943`*^9, 3.6721957755720387`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"isGS", "=", 
     RowBox[{
     "1", " ", "for", " ", "the", " ", "ground", " ", "state", " ", 
      "calculation"}]}], ",", " ", 
    RowBox[{
     RowBox[{"other", " ", "value", " ", "does", " ", "not", " ", "work"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"iDMRG", "=", 
      RowBox[{
      "False", " ", "for", " ", "a", " ", "random", " ", "initial", " ", 
       "state"}]}]}], ",", " ", 
    RowBox[{
    "otherwise", " ", "the", " ", "initial", " ", "state", " ", "will", " ", 
     "build", " ", "from", " ", "iDMRG"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"fDMRG", "[", 
     RowBox[{"h_", ",", "isGS_", ",", "iDMRGM_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "sz", ",", "sx", ",", "sy", ",", "EGS", ",", "M", ",", "Mz", ",", 
        "Mxx", ",", "R", ",", "L", ",", "Rtmp", ",", "heff", ",", "heffmat", 
        ",", "dim", ",", "mlvect", ",", "mlmat", ",", "U", ",", "S", ",", "V",
         ",", "dleft", ",", "dright"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{"iDMRGM", ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"EGS", ",", "M"}], "}"}], "=", 
          RowBox[{"iDMRG", "[", 
           RowBox[{"h", ",", "isGS"}], "]"}]}], ",", 
         RowBox[{"M", "=", 
          RowBox[{"rightNormalize", "[", 
           RowBox[{"randomMPS", "[", "]"}], "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Mz", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"Null", ",", 
          RowBox[{"{", "NN", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Mxx", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"Null", ",", 
          RowBox[{"{", 
           RowBox[{"NN", "-", "1"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sz", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1.", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"-", "1."}]}], "}"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sx", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "1."}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1.", ",", "0"}], "}"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sy", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"-", "1."}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1.", ",", "0"}], "}"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"R", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"Null", ",", 
          RowBox[{"{", 
           RowBox[{"NN", "-", "1"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Rtmp", "=", 
        RowBox[{"Activate", " ", "@", " ", 
         RowBox[{"TensorContract", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
            RowBox[{
             RowBox[{"M", "[", 
              RowBox[{"[", "NN", "]"}], "]"}], ",", 
             RowBox[{"MPO", "[", 
              RowBox[{"h", ",", "NN"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "7"}], "}"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Rtmp", "=", 
        RowBox[{"Activate", " ", "@", " ", 
         RowBox[{"TensorContract", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
            RowBox[{"Rtmp", ",", 
             RowBox[{"Conjugate", "[", 
              RowBox[{"M", "[", 
               RowBox[{"[", "NN", "]"}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"5", ",", "6"}], "}"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Rtmp", "=", 
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{"Rtmp", ",", 
           RowBox[{"{", 
            RowBox[{"4", ",", "1", ",", "5", ",", "2", ",", "6", ",", "3"}], 
            "}"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"R", "[", 
         RowBox[{"[", 
          RowBox[{"NN", "-", "1"}], "]"}], "]"}], "=", "Rtmp"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Rtmp", "=", 
           RowBox[{"Activate", " ", "@", " ", 
            RowBox[{"TensorContract", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
               RowBox[{
                RowBox[{"R", "[", 
                 RowBox[{"[", 
                  RowBox[{"l", "+", "1"}], "]"}], "]"}], ",", 
                RowBox[{"M", "[", 
                 RowBox[{"[", 
                  RowBox[{"l", "+", "1"}], "]"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "6"}], "}"}]}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Rtmp", "=", 
           RowBox[{"Activate", " ", "@", " ", 
            RowBox[{"TensorContract", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
               RowBox[{"Rtmp", ",", 
                RowBox[{"MPO", "[", 
                 RowBox[{"h", ",", 
                  RowBox[{"l", "+", "1"}]}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"1", ",", "6"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"3", ",", "8"}], "}"}]}], "}"}]}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Rtmp", "=", 
           RowBox[{"Activate", " ", "@", " ", 
            RowBox[{"TensorContract", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
               RowBox[{"Rtmp", ",", 
                RowBox[{"Conjugate", "[", 
                 RowBox[{"M", "[", 
                  RowBox[{"[", 
                   RowBox[{"l", "+", "1"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"1", ",", "7"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"4", ",", "5"}], "}"}]}], "}"}]}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"R", "[", 
            RowBox[{"[", "l", "]"}], "]"}], "=", "Rtmp"}]}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l", ",", 
           RowBox[{"NN", "-", "2"}], ",", "1", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"L", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"Null", ",", 
          RowBox[{"{", 
           RowBox[{"NN", "-", "1"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"l", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"heff", "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{
                    RowBox[{"MPO", "[", 
                    RowBox[{"h", ",", "l"}], "]"}], ",", 
                    RowBox[{"R", "[", 
                    RowBox[{"[", "l", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "6"}], "}"}]}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"heff", "=", 
                 RowBox[{"ArrayReshape", "[", 
                  RowBox[{"heff", ",", 
                   RowBox[{"Insert", "[", 
                    RowBox[{
                    RowBox[{"Dimensions", "[", "heff", "]"}], ",", "1", ",", 
                    "1"}], "]"}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"heff", "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{
                    RowBox[{"L", "[", 
                    RowBox[{"[", 
                    RowBox[{"l", "-", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"MPO", "[", 
                    RowBox[{"h", ",", "l"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"heff", "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{"heff", ",", 
                    RowBox[{"R", "[", 
                    RowBox[{"[", "l", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", "7"}], "}"}]}], "]"}]}]}]}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"dim", "=", 
              RowBox[{"Dimensions", "[", "heff", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"heffmat", "=", 
              RowBox[{"ArrayReshape", "[", 
               RowBox[{
                RowBox[{"Transpose", "[", 
                 RowBox[{"heff", ",", 
                  RowBox[{"{", 
                   RowBox[{
                   "5", ",", "2", ",", "1", ",", "4", ",", "6", ",", "3"}], 
                   "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"dim", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", 
                   RowBox[{"dim", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], " ", 
                   RowBox[{"dim", "[", 
                    RowBox[{"[", "6", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{"dim", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", 
                   RowBox[{"dim", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], " ", 
                   RowBox[{"dim", "[", 
                    RowBox[{"[", "5", "]"}], "]"}]}]}], "}"}]}], "]"}]}], ";",
              "\[IndentingNewLine]", 
             RowBox[{"dim", "=", 
              RowBox[{"Dimensions", "[", 
               RowBox[{"M", "[", 
                RowBox[{"[", "l", "]"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"mlvect", "=", 
              RowBox[{"ArrayReshape", "[", 
               RowBox[{
                RowBox[{"M", "[", 
                 RowBox[{"[", "l", "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"dim", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], " ", 
                  RowBox[{"dim", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], " ", 
                  RowBox[{"dim", "[", 
                   RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"isGS", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
               
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"EGS", ",", "mlvect"}], "}"}], "=", 
                 RowBox[{"Eigensystem", "[", 
                  RowBox[{
                   RowBox[{"-", "heffmat"}], ",", "1", ",", 
                   RowBox[{"Method", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"\"\<Arnoldi\>\"", ",", 
                    RowBox[{
                    "\"\<Criteria\>\"", "\[Rule]", "\"\<RealPart\>\""}], ",", 
                    
                    RowBox[{"\"\<StartingVector\>\"", "\[Rule]", "mlvect"}]}],
                     "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"EGS", "=", 
                 RowBox[{"-", 
                  RowBox[{"EGS", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"mlvect", "=", 
                 RowBox[{"mlvect", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"EGS", ",", "mlvect"}], "}"}], "=", 
                 RowBox[{"Eigensystem", "[", 
                  RowBox[{
                   RowBox[{"-", "heffmat"}], ",", "2", ",", 
                   RowBox[{"Method", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"\"\<Arnoldi\>\"", ",", 
                    RowBox[{
                    "\"\<Criteria\>\"", "\[Rule]", "\"\<RealPart\>\""}], ",", 
                    
                    RowBox[{"\"\<StartingVector\>\"", "\[Rule]", "mlvect"}]}],
                     "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"EGS", "=", 
                 RowBox[{"-", 
                  RowBox[{"EGS", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"mlvect", "=", 
                 RowBox[{"mlvect", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}]}]}], "\[IndentingNewLine]",
               "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"mlmat", "=", 
              RowBox[{"ArrayReshape", "[", 
               RowBox[{"mlvect", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"dim", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", 
                   RowBox[{"dim", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{"dim", "[", 
                   RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"U", ",", "S", ",", "V"}], "}"}], "=", 
              RowBox[{"SingularValueDecomposition", "[", 
               RowBox[{"mlmat", ",", 
                RowBox[{"Min", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Dimensions", "[", "mlmat", "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"Dimensions", "[", "mlmat", "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", "DD"}], "]"}]}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"l", "\[Equal]", "1"}], "&&", 
                RowBox[{"isweep", "\[Equal]", "sweep"}]}], ",", 
               RowBox[{
                RowBox[{"Mz", "[", 
                 RowBox[{"[", "l", "]"}], "]"}], "=", 
                RowBox[{"opexpval", "[", 
                 RowBox[{
                  RowBox[{"M", "[", 
                   RowBox[{"[", "l", "]"}], "]"}], ",", "sz"}], "]"}]}]}], 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"l", "\[Equal]", "1"}], "&&", 
                RowBox[{"isweep", "\[Equal]", "sweep"}]}], ",", 
               RowBox[{
                RowBox[{"Mxx", "[", 
                 RowBox[{"[", "l", "]"}], "]"}], "=", 
                RowBox[{"opexpval2", "[", 
                 RowBox[{"M", ",", "sx", ",", "sx", ",", "l", ",", 
                  RowBox[{"l", "+", "1"}]}], "]"}]}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"dim", "=", 
              RowBox[{
               RowBox[{"Dimensions", "[", "S", "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"M", "[", 
               RowBox[{"[", "l", "]"}], "]"}], "=", 
              RowBox[{"ArrayReshape", "[", 
               RowBox[{"U", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Dimensions", "[", 
                    RowBox[{"M", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"Dimensions", "[", 
                    RowBox[{"M", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", "dim"}], "}"}]}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"M", "[", 
               RowBox[{"[", 
                RowBox[{"l", "+", "1"}], "]"}], "]"}], "=", 
              RowBox[{"Activate", " ", "@", " ", 
               RowBox[{"TensorContract", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                  RowBox[{
                   RowBox[{"V", "\[HermitianConjugate]"}], ",", 
                   RowBox[{"M", "[", 
                    RowBox[{"[", 
                    RowBox[{"l", "+", "1"}], "]"}], "]"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"2", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"M", "[", 
               RowBox[{"[", 
                RowBox[{"l", "+", "1"}], "]"}], "]"}], "=", 
              RowBox[{"Transpose", "[", 
               RowBox[{"Activate", " ", "@", " ", 
                RowBox[{"TensorContract", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                   RowBox[{"S", ",", 
                    RowBox[{"M", "[", 
                    RowBox[{"[", 
                    RowBox[{"l", "+", "1"}], "]"}], "]"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"2", ",", "3"}], "}"}]}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"l", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"L", "[", 
                  RowBox[{"[", "l", "]"}], "]"}], "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{
                    RowBox[{"M", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], ",", 
                    RowBox[{"MPO", "[", 
                    RowBox[{"h", ",", "l"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "7"}], "}"}]}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"L", "[", 
                  RowBox[{"[", "l", "]"}], "]"}], "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{
                    RowBox[{"L", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], ",", 
                    RowBox[{"Conjugate", "[", 
                    RowBox[{"M", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"5", ",", "6"}], "}"}]}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"L", "[", 
                  RowBox[{"[", "l", "]"}], "]"}], "=", 
                 RowBox[{
                  RowBox[{"Transpose", "[", 
                   RowBox[{
                    RowBox[{"L", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "1", ",", "4", ",", "2", ",", "5", ",", "3", ",", "6"}], 
                    "}"}]}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"L", "[", 
                  RowBox[{"[", "l", "]"}], "]"}], "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{
                    RowBox[{"L", "[", 
                    RowBox[{"[", 
                    RowBox[{"l", "-", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"M", "[", 
                    RowBox[{"[", "l", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "5"}], "}"}]}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"L", "[", 
                  RowBox[{"[", "l", "]"}], "]"}], "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{
                    RowBox[{"L", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], ",", 
                    RowBox[{"MPO", "[", 
                    RowBox[{"h", ",", "l"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "5"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", "8"}], "}"}]}], "}"}]}], "]"}]}]}], ";",
                 "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"L", "[", 
                  RowBox[{"[", "l", "]"}], "]"}], "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{
                    RowBox[{"L", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], ",", 
                    RowBox[{"Conjugate", "[", 
                    RowBox[{"M", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "6"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"4", ",", "5"}], "}"}]}], "}"}]}], "]"}]}]}]}]}], 
              "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"NN", "-", "1"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Print", "[", "isweep", "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"l", "\[Equal]", "NN"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"heff", "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{
                    RowBox[{"L", "[", 
                    RowBox[{"[", 
                    RowBox[{"l", "-", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"MPO", "[", 
                    RowBox[{"h", ",", "l"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"heff", "=", 
                 RowBox[{
                  RowBox[{"Transpose", "[", 
                   RowBox[{"heff", ",", 
                    RowBox[{"{", 
                    RowBox[{"5", ",", "3", ",", "1", ",", "2", ",", "4"}], 
                    "}"}]}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"dim", "=", 
                 RowBox[{"Dimensions", "[", "heff", "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"heffmat", "=", 
                 RowBox[{"ArrayReshape", "[", 
                  RowBox[{"heff", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"dim", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", 
                    RowBox[{"dim", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"dim", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], " ", 
                    RowBox[{"dim", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}]}], "}"}]}], "]"}]}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"heff", "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{
                    RowBox[{"L", "[", 
                    RowBox[{"[", 
                    RowBox[{"l", "-", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"MPO", "[", 
                    RowBox[{"h", ",", "l"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"heff", "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{"heff", ",", 
                    RowBox[{"R", "[", 
                    RowBox[{"[", "l", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", "7"}], "}"}]}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"dim", "=", 
                 RowBox[{"Dimensions", "[", "heff", "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"heffmat", "=", 
                 RowBox[{"ArrayReshape", "[", 
                  RowBox[{
                   RowBox[{"Transpose", "[", 
                    RowBox[{"heff", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "5", ",", "2", ",", "1", ",", "4", ",", "6", ",", "3"}], 
                    "}"}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"dim", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", 
                    RowBox[{"dim", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], " ", 
                    RowBox[{"dim", "[", 
                    RowBox[{"[", "6", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"dim", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", 
                    RowBox[{"dim", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], " ", 
                    RowBox[{"dim", "[", 
                    RowBox[{"[", "5", "]"}], "]"}]}]}], "}"}]}], "]"}]}]}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"dim", "=", 
              RowBox[{"Dimensions", "[", 
               RowBox[{"M", "[", 
                RowBox[{"[", "l", "]"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"mlvect", "=", 
              RowBox[{"ArrayReshape", "[", 
               RowBox[{
                RowBox[{"M", "[", 
                 RowBox[{"[", "l", "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"dim", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], " ", 
                  RowBox[{"dim", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], " ", 
                  RowBox[{"dim", "[", 
                   RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"isGS", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
               
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"EGS", ",", "mlvect"}], "}"}], "=", 
                 RowBox[{"Eigensystem", "[", 
                  RowBox[{
                   RowBox[{"-", "heffmat"}], ",", "1", ",", 
                   RowBox[{"Method", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"\"\<Arnoldi\>\"", ",", 
                    RowBox[{
                    "\"\<Criteria\>\"", "\[Rule]", "\"\<RealPart\>\""}], ",", 
                    
                    RowBox[{"\"\<StartingVector\>\"", "\[Rule]", "mlvect"}]}],
                     "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"EGS", "=", 
                 RowBox[{"-", 
                  RowBox[{"EGS", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"mlvect", "=", 
                 RowBox[{"mlvect", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"EGS", ",", "mlvect"}], "}"}], "=", 
                 RowBox[{"Eigensystem", "[", 
                  RowBox[{
                   RowBox[{"-", "heffmat"}], ",", "2", ",", 
                   RowBox[{"Method", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"\"\<Arnoldi\>\"", ",", 
                    RowBox[{
                    "\"\<Criteria\>\"", "\[Rule]", "\"\<RealPart\>\""}], ",", 
                    
                    RowBox[{"\"\<StartingVector\>\"", "\[Rule]", "mlvect"}]}],
                     "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"EGS", "=", 
                 RowBox[{"-", 
                  RowBox[{"EGS", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"mlvect", "=", 
                 RowBox[{"mlvect", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}]}]}], "\[IndentingNewLine]",
               "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"M", "[", 
               RowBox[{"[", "l", "]"}], "]"}], "=", 
              RowBox[{"ArrayReshape", "[", 
               RowBox[{"mlvect", ",", "dim"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"dleft", "=", 
              RowBox[{
               RowBox[{"Dimensions", "[", 
                RowBox[{"M", "[", 
                 RowBox[{"[", "l", "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"dright", "=", 
              RowBox[{
               RowBox[{"Dimensions", "[", 
                RowBox[{"M", "[", 
                 RowBox[{"[", "l", "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"mlmat", "=", 
              RowBox[{"ArrayReshape", "[", 
               RowBox[{
                RowBox[{"Transpose", "[", 
                 RowBox[{"M", "[", 
                  RowBox[{"[", "l", "]"}], "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"dleft", ",", 
                  RowBox[{"dright", " ", "d"}]}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"U", ",", "S", ",", "V"}], "}"}], "=", 
              RowBox[{"SingularValueDecomposition", "[", 
               RowBox[{"mlmat", ",", 
                RowBox[{"Min", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Dimensions", "[", "mlmat", "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"Dimensions", "[", "mlmat", "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", "DD"}], "]"}]}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"isweep", "\[Equal]", "sweep"}], ",", 
               RowBox[{
                RowBox[{"Mz", "[", 
                 RowBox[{"[", "l", "]"}], "]"}], "=", 
                RowBox[{"opexpval", "[", 
                 RowBox[{
                  RowBox[{"M", "[", 
                   RowBox[{"[", "l", "]"}], "]"}], ",", "sz"}], "]"}]}]}], 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"l", "+", "1"}], "\[LessEqual]", "NN"}], "&&", 
                RowBox[{"isweep", "\[Equal]", "sweep"}]}], ",", 
               RowBox[{
                RowBox[{"Mxx", "[", 
                 RowBox[{"[", "l", "]"}], "]"}], "=", 
                RowBox[{"opexpval2", "[", 
                 RowBox[{"M", ",", "sx", ",", "sx", ",", "l", ",", 
                  RowBox[{"l", "+", "1"}]}], "]"}]}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"dim", "=", 
              RowBox[{
               RowBox[{"Dimensions", "[", "S", "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"M", "[", 
               RowBox[{"[", "l", "]"}], "]"}], "=", 
              RowBox[{"Transpose", "[", 
               RowBox[{"ArrayReshape", "[", 
                RowBox[{
                 RowBox[{"V", "\[HermitianConjugate]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"dim", ",", "d", ",", "dright"}], "}"}]}], "]"}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"M", "[", 
               RowBox[{"[", 
                RowBox[{"l", "-", "1"}], "]"}], "]"}], "=", 
              RowBox[{"Activate", " ", "@", " ", 
               RowBox[{"TensorContract", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                  RowBox[{
                   RowBox[{"M", "[", 
                    RowBox[{"[", 
                    RowBox[{"l", "-", "1"}], "]"}], "]"}], ",", "U"}], "]"}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{"3", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"M", "[", 
               RowBox[{"[", 
                RowBox[{"l", "-", "1"}], "]"}], "]"}], "=", 
              RowBox[{"Activate", " ", "@", " ", 
               RowBox[{"TensorContract", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                  RowBox[{
                   RowBox[{"M", "[", 
                    RowBox[{"[", 
                    RowBox[{"l", "-", "1"}], "]"}], "]"}], ",", "S"}], "]"}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{"3", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"l", "\[Equal]", "NN"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Rtmp", "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{
                    RowBox[{"M", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], ",", 
                    RowBox[{"MPO", "[", 
                    RowBox[{"h", ",", "l"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "7"}], "}"}]}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Rtmp", "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{"Rtmp", ",", 
                    RowBox[{"Conjugate", "[", 
                    RowBox[{"M", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"5", ",", "6"}], "}"}]}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Rtmp", "=", 
                 RowBox[{
                  RowBox[{"Transpose", "[", 
                   RowBox[{"Rtmp", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "4", ",", "1", ",", "5", ",", "2", ",", "6", ",", "3"}], 
                    "}"}]}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"R", "[", 
                  RowBox[{"[", 
                   RowBox[{"l", "-", "1"}], "]"}], "]"}], "=", "Rtmp"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Rtmp", "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{
                    RowBox[{"R", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], ",", 
                    RowBox[{"M", "[", 
                    RowBox[{"[", "l", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "6"}], "}"}]}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Rtmp", "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{"Rtmp", ",", 
                    RowBox[{"MPO", "[", 
                    RowBox[{"h", ",", "l"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "6"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", "8"}], "}"}]}], "}"}]}], "]"}]}]}], ";",
                 "\[IndentingNewLine]", 
                RowBox[{"Rtmp", "=", 
                 RowBox[{"Activate", " ", "@", " ", 
                  RowBox[{"TensorContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                    RowBox[{"Rtmp", ",", 
                    RowBox[{"Conjugate", "[", 
                    RowBox[{"M", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "7"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"4", ",", "5"}], "}"}]}], "}"}]}], "]"}]}]}], ";",
                 "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"R", "[", 
                  RowBox[{"[", 
                   RowBox[{"l", "-", "1"}], "]"}], "]"}], "=", "Rtmp"}]}]}], 
              "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "NN", ",", "2", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
         ",", 
         RowBox[{"{", 
          RowBox[{"isweep", ",", "1", ",", "sweep"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"EGS", ",", "Mxx", ",", "Mz"}], "}"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.672195425103833*^9, 3.672195467946824*^9}, 
   3.6722002378332577`*^9, {3.672203195813629*^9, 3.672203196959715*^9}, {
   3.6722721617996283`*^9, 3.672272210696439*^9}, {3.672272455288361*^9, 
   3.672272456968904*^9}, {3.6722733243175077`*^9, 3.672273364829976*^9}, {
   3.672273446065201*^9, 3.6722734617347918`*^9}, {3.672273599798317*^9, 
   3.6722736044207706`*^9}, {3.67227367847194*^9, 3.6722736818513527`*^9}, {
   3.672274127824885*^9, 3.672274246491193*^9}, {3.672277050662592*^9, 
   3.6722770971942472`*^9}, {3.6741920228923078`*^9, 3.6741921180333915`*^9}, 
   3.674192425872123*^9, 3.674192960726935*^9, {3.674193011019586*^9, 
   3.6741930111733637`*^9}, {3.6741930490182343`*^9, 3.6741931202945395`*^9}, 
   3.674193152900657*^9, 3.6741932055786037`*^9, {3.674193240388274*^9, 
   3.6741932695316534`*^9}, {3.674193374110999*^9, 3.67419339033718*^9}, {
   3.674193460140579*^9, 3.6741935022828894`*^9}, {3.67420373152003*^9, 
   3.674203788494317*^9}, {3.674204175326791*^9, 3.674204206163675*^9}, {
   3.6747711309193854`*^9, 3.674771132439784*^9}, 3.674771316232045*^9, {
   3.6747714847610035`*^9, 3.6747715673771353`*^9}, 3.6747716716529527`*^9, 
   3.674771854908616*^9, {3.6747729255274897`*^9, 3.6747729391446586`*^9}, {
   3.6747739988089848`*^9, 3.6747740035988984`*^9}, {3.674774175841918*^9, 
   3.6747741786609044`*^9}, 3.674774282444073*^9, 3.6747743344183416`*^9, {
   3.674775613224059*^9, 3.6747756563789425`*^9}, {3.6747756865738764`*^9, 
   3.67477572114572*^9}, {3.674776634845525*^9, 3.6747766394028683`*^9}, {
   3.6747767010712748`*^9, 3.6747767071274395`*^9}, {3.6748829843191643`*^9, 
   3.6748829922100897`*^9}, {3.6748830227357206`*^9, 
   3.6748830305358095`*^9}, {3.674883185464111*^9, 3.674883244855387*^9}, {
   3.6748836125657616`*^9, 3.674883625723572*^9}, {3.6748837390587683`*^9, 
   3.6748837458029428`*^9}, {3.674885313579092*^9, 3.6748853882194386`*^9}, {
   3.6748854724117193`*^9, 3.674885505339381*^9}, {3.6748857428183813`*^9, 
   3.6748857537480073`*^9}, {3.674885959507663*^9, 3.674885987168132*^9}, {
   3.67488955150498*^9, 3.67488956255869*^9}, {3.6748901700791225`*^9, 
   3.674890229000878*^9}, {3.674890497734474*^9, 3.674890508434221*^9}, {
   3.6748905442319255`*^9, 3.674890544532729*^9}, {3.674968395021908*^9, 
   3.6749684030530553`*^9}, {3.674970250469324*^9, 3.6749702573980927`*^9}, 
   3.674976147201399*^9, {3.6749792551853175`*^9, 3.674979360177129*^9}, {
   3.6749794514205484`*^9, 3.674979452784563*^9}, {3.6750464805942907`*^9, 
   3.675046494268466*^9}, {3.6750466216581526`*^9, 3.6750466274990287`*^9}, 
   3.675046765293433*^9, 3.6750468639727287`*^9, {3.6750532493321285`*^9, 
   3.675053260329254*^9}, {3.6750533208487015`*^9, 3.675053355895132*^9}, 
   3.6750533880658245`*^9, {3.675053457980776*^9, 3.6750534584798565`*^9}, {
   3.675053729378585*^9, 3.67505373166779*^9}, {3.6751220789241743`*^9, 
   3.675122140332126*^9}, {3.6751221845281925`*^9, 3.675122213783764*^9}, {
   3.675122343145707*^9, 3.675122344432334*^9}, {3.675139397202093*^9, 
   3.6751394722512107`*^9}, {3.6751395584876924`*^9, 3.675139561330782*^9}, {
   3.675139681260884*^9, 3.6751397624463162`*^9}, {3.67513982730424*^9, 
   3.6751398276693735`*^9}, {3.6751411447215014`*^9, 3.6751411464742403`*^9}, 
   3.6751413107993183`*^9, 3.675141558143529*^9, {3.6751429371550817`*^9, 
   3.6751429668372436`*^9}, {3.714643308660688*^9, 3.714643428992187*^9}, {
   3.714643460975333*^9, 3.714643469026235*^9}, {3.7146435485771427`*^9, 
   3.7146435731236753`*^9}, {3.7503780133814*^9, 3.750378050721719*^9}, {
   3.750378099300025*^9, 3.750378224573327*^9}, {3.7503782630123587`*^9, 
   3.750378270773259*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["iDMRG", "Title",
 CellChangeTimes->{{3.6721946591617813`*^9, 3.672194662388674*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"iDMRG", "[", 
    RowBox[{"h_", ",", "isGS_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "M", ",", "SS", ",", "L", ",", "R", ",", "mpo", ",", "mpo1", ",", 
       "mpo2", ",", "MMPO", ",", "heff", ",", "MA", ",", "MB", ",", 
       "\[CapitalLambda]L", ",", "\[CapitalLambda]R", ",", "\[Psi]init", ",", 
       "\[Psi]", ",", "\[CurlyEpsilon]", ",", "EGS", ",", "U", ",", "S", ",", 
       "V", ",", "dim", ",", "dims"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"M", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"Null", ",", 
         RowBox[{"{", "NN", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"SS", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"Null", ",", 
         RowBox[{"{", "NN", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mpo", "=", 
       RowBox[{"MPO", "[", 
        RowBox[{"h", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mpo1", "=", 
       RowBox[{"MPO", "[", 
        RowBox[{"h", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mpo2", "=", 
       RowBox[{"MPO", "[", 
        RowBox[{"h", ",", "NN"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"MMPO", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{"mpo", ",", "mpo"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "5"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"initial", " ", "two", " ", "sites"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[CurlyEpsilon]", ",", "\[Psi]"}], "}"}], "=", 
       RowBox[{"Eigensystem", "[", 
        RowBox[{"h1", "[", "h", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[CurlyEpsilon]", ",", "\[Psi]"}], "}"}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[CurlyEpsilon]", "[", 
            RowBox[{"[", "#", "]"}], "]"}], ",", 
           RowBox[{"\[Psi]", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}], "}"}], "&"}], "@", 
        RowBox[{"Ordering", "[", "\[CurlyEpsilon]", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Psi]", "=", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{
         RowBox[{"\[Psi]", "[", 
          RowBox[{"[", 
           RowBox[{"2", "-", "isGS"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"d", ",", "d"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"U", ",", "S", ",", "V"}], "}"}], "=", 
       RowBox[{"SingularValueDecomposition", "[", "\[Psi]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"M", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "=", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"U", ",", 
         RowBox[{"{", 
          RowBox[{"d", ",", "1", ",", "d"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"M", "[", 
        RowBox[{"[", 
         RowBox[{"-", "1"}], "]"}], "]"}], "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"ArrayReshape", "[", 
         RowBox[{
          RowBox[{"V", "\[HermitianConjugate]"}], ",", 
          RowBox[{"{", 
           RowBox[{"d", ",", "d", ",", "1"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"SS", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "=", "S"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"L", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{
            RowBox[{"M", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "mpo1"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "7"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"L", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{"L", ",", 
            RowBox[{"Conjugate", "[", 
             RowBox[{"M", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"5", ",", "6"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"L", "=", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"L", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "4", ",", "2", ",", "5", ",", "3", ",", "6"}], 
           "}"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"R", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{
            RowBox[{"M", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}], ",", "mpo2"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "7"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"R", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{"R", ",", 
            RowBox[{"Conjugate", "[", 
             RowBox[{"M", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"5", ",", "6"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"R", "=", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"R", ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "1", ",", "5", ",", "2", ",", "6", ",", "3"}], 
           "}"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"initial", " ", "four", " ", "sites"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"heff", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{"L", ",", "MMPO"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"heff", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{"heff", ",", "R"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"5", ",", "9"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"heff", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"heff", ",", 
         RowBox[{"{", 
          RowBox[{
          "6", ",", "2", ",", "1", ",", "5", ",", "3", ",", "7", ",", "8", 
           ",", "4"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[CurlyEpsilon]", ",", "\[Psi]"}], "}"}], "=", 
       RowBox[{"Eigensystem", "[", 
        RowBox[{"ArrayReshape", "[", 
         RowBox[{"heff", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"d", "^", "4"}], ",", 
            RowBox[{"d", "^", "4"}]}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[CurlyEpsilon]", ",", "\[Psi]"}], "}"}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[CurlyEpsilon]", "[", 
            RowBox[{"[", "#", "]"}], "]"}], ",", 
           RowBox[{"\[Psi]", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}], "}"}], "&"}], "@", 
        RowBox[{"Ordering", "[", "\[CurlyEpsilon]", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Psi]", "=", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{
         RowBox[{"\[Psi]", "[", 
          RowBox[{"[", 
           RowBox[{"2", "-", "isGS"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"d", "^", "2"}], ",", 
           RowBox[{"d", "^", "2"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"U", ",", "S", ",", "V"}], "}"}], "=", 
       RowBox[{"SingularValueDecomposition", "[", "\[Psi]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"M", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "=", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"U", ",", 
         RowBox[{"{", 
          RowBox[{"d", ",", "d", ",", 
           RowBox[{"d", "^", "2"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"M", "[", 
        RowBox[{"[", 
         RowBox[{"-", "2"}], "]"}], "]"}], "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"ArrayReshape", "[", 
         RowBox[{
          RowBox[{"V", "\[HermitianConjugate]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"d", "^", "2"}], ",", "d", ",", "d"}], "}"}]}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"SS", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "=", "S"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"L", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{"L", ",", 
            RowBox[{"M", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "5"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"L", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{"L", ",", "mpo"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", "8"}], "}"}]}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"L", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{"L", ",", 
            RowBox[{"Conjugate", "[", 
             RowBox[{"M", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "6"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"4", ",", "5"}], "}"}]}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"R", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{"R", ",", 
            RowBox[{"M", "[", 
             RowBox[{"[", 
              RowBox[{"-", "2"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "6"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"R", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{"R", ",", "mpo"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "6"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", "8"}], "}"}]}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"R", "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{"R", ",", 
            RowBox[{"Conjugate", "[", 
             RowBox[{"M", "[", 
              RowBox[{"[", 
               RowBox[{"-", "2"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "7"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"4", ",", "5"}], "}"}]}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"MA", "=", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Activate", " ", "@", " ", 
            RowBox[{"TensorContract", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
               RowBox[{
                RowBox[{"SS", "[", 
                 RowBox[{"[", "isite", "]"}], "]"}], ",", 
                RowBox[{"M", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "isite"}], "]"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"2", ",", "4"}], "}"}]}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dim", "=", 
          RowBox[{"Dimensions", "[", "MA", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dims", "=", 
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"dim", "[", 
              RowBox[{"[", "2", "]"}], "]"}], " ", "d"}], ",", 
            RowBox[{"dim", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"U", ",", "S", ",", "V"}], "}"}], "=", 
          RowBox[{"SingularValueDecomposition", "[", 
           RowBox[{
            RowBox[{"ArrayReshape", "[", 
             RowBox[{"MA", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"dim", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], " ", "d"}], ",", 
                RowBox[{"dim", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            "dims"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"MA", "=", 
          RowBox[{"ArrayReshape", "[", 
           RowBox[{"U", ",", 
            RowBox[{"{", 
             RowBox[{"d", ",", 
              RowBox[{"dim", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"dim", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"\[CapitalLambda]R", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{"S", ",", 
               RowBox[{"V", "\[HermitianConjugate]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "3"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"MB", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{
               RowBox[{"M", "[", 
                RowBox[{"[", "isite", "]"}], "]"}], ",", 
               RowBox[{"SS", "[", 
                RowBox[{"[", "isite", "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"3", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dim", "=", 
          RowBox[{"Dimensions", "[", "MB", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dims", "=", 
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{"dim", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"d", " ", 
             RowBox[{"dim", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"U", ",", "S", ",", "V"}], "}"}], "=", 
          RowBox[{"SingularValueDecomposition", "[", 
           RowBox[{
            RowBox[{"ArrayReshape", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", "MB", "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"dim", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", 
                RowBox[{"d", " ", 
                 RowBox[{"dim", "[", 
                  RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}], "]"}], ",", 
            "dims"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"MB", "=", 
          RowBox[{"Transpose", "[", 
           RowBox[{"ArrayReshape", "[", 
            RowBox[{
             RowBox[{"V", "\[HermitianConjugate]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"dim", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "d", ",", 
               RowBox[{"dim", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"\[CapitalLambda]L", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{"U", ",", "S"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "3"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"\[Psi]init", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{"MA", ",", 
               RowBox[{"\[CapitalLambda]R", ".", 
                RowBox[{"PseudoInverse", "[", 
                 RowBox[{"SS", "[", 
                  RowBox[{"[", 
                   RowBox[{"isite", "-", "1"}], "]"}], "]"}], "]"}], ".", 
                "\[CapitalLambda]L"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"3", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"\[Psi]init", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{"\[Psi]init", ",", "MB"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"3", ",", "5"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dim", "=", 
          RowBox[{"Dimensions", "[", "\[Psi]init", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"\[Psi]init", "=", 
          RowBox[{"ArrayReshape", "[", 
           RowBox[{"\[Psi]init", ",", 
            RowBox[{"{", 
             RowBox[{"d", "*", 
              RowBox[{"dim", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "*", "d", "*", 
              RowBox[{"dim", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"heff", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{"L", ",", "MMPO"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"heff", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{"heff", ",", "R"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"5", ",", "9"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"heff", "=", 
          RowBox[{"Transpose", "[", 
           RowBox[{"heff", ",", 
            RowBox[{"{", 
             RowBox[{
             "6", ",", "2", ",", "1", ",", "5", ",", "3", ",", "7", ",", "8", 
              ",", "4"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"dim", "=", 
          RowBox[{"Dimensions", "[", "heff", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"heff", "=", 
          RowBox[{"ArrayReshape", "[", 
           RowBox[{"heff", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"d", "*", "d", "*", 
               RowBox[{"dim", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "*", 
               RowBox[{"dim", "[", 
                RowBox[{"[", "4", "]"}], "]"}]}], ",", 
              RowBox[{"d", "*", "d", "*", 
               RowBox[{"dim", "[", 
                RowBox[{"[", "6", "]"}], "]"}], "*", 
               RowBox[{"dim", "[", 
                RowBox[{"[", "8", "]"}], "]"}]}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"isGS", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"EGS", ",", "\[Psi]"}], "}"}], "=", 
             RowBox[{"Eigensystem", "[", 
              RowBox[{
               RowBox[{"-", "heff"}], ",", "1", ",", 
               RowBox[{"Method", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"\"\<Arnoldi\>\"", ",", 
                  RowBox[{"\"\<Criteria\>\"", "\[Rule]", "\"\<RealPart\>\""}],
                   ",", 
                  RowBox[{
                  "\"\<StartingVector\>\"", "\[Rule]", "\[Psi]init"}]}], 
                 "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"EGS", "=", 
             RowBox[{"-", 
              RowBox[{"EGS", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"\[Psi]", "=", 
             RowBox[{"\[Psi]", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
           
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"EGS", ",", "\[Psi]"}], "}"}], "=", 
             RowBox[{"Eigensystem", "[", 
              RowBox[{
               RowBox[{"-", "heff"}], ",", "2", ",", 
               RowBox[{"Method", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"\"\<Arnoldi\>\"", ",", 
                  RowBox[{"\"\<Criteria\>\"", "\[Rule]", "\"\<RealPart\>\""}],
                   ",", 
                  RowBox[{
                  "\"\<StartingVector\>\"", "\[Rule]", "\[Psi]init"}]}], 
                 "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"EGS", "=", 
             RowBox[{"-", 
              RowBox[{"EGS", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"\[Psi]", "=", 
             RowBox[{"\[Psi]", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"\[Psi]", "=", 
          RowBox[{"ArrayReshape", "[", 
           RowBox[{"\[Psi]", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"d", "*", 
               RowBox[{"dim", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"d", "*", 
               RowBox[{"dim", "[", 
                RowBox[{"[", "4", "]"}], "]"}]}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dims", "=", 
          RowBox[{"Min", "[", 
           RowBox[{"DD", ",", 
            RowBox[{"Length", "[", "\[Psi]", "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"U", ",", "S", ",", "V"}], "}"}], "=", 
          RowBox[{"SingularValueDecomposition", "[", 
           RowBox[{"\[Psi]", ",", "dims"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{"isite", "+", "1"}], "]"}], "]"}], "=", 
          RowBox[{"ArrayReshape", "[", 
           RowBox[{"U", ",", 
            RowBox[{"{", 
             RowBox[{"d", ",", 
              RowBox[{"dim", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "dims"}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"SS", "[", 
           RowBox[{"[", 
            RowBox[{"isite", "+", "1"}], "]"}], "]"}], "=", "S"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"M", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"-", "isite"}], "-", "1"}], "]"}], "]"}], "=", 
          RowBox[{"Transpose", "[", 
           RowBox[{"ArrayReshape", "[", 
            RowBox[{
             RowBox[{"V", "\[HermitianConjugate]"}], ",", 
             RowBox[{"{", 
              RowBox[{"dims", ",", "d", ",", 
               RowBox[{"dim", "[", 
                RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], "]"}], "]"}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"L", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{"L", ",", 
               RowBox[{"M", "[", 
                RowBox[{"[", 
                 RowBox[{"isite", "+", "1"}], "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "5"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"L", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{"L", ",", "mpo"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "5"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"3", ",", "8"}], "}"}]}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"L", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{"L", ",", 
               RowBox[{"Conjugate", "[", 
                RowBox[{"M", "[", 
                 RowBox[{"[", 
                  RowBox[{"isite", "+", "1"}], "]"}], "]"}], "]"}]}], "]"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "6"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"4", ",", "5"}], "}"}]}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"R", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{"R", ",", 
               RowBox[{"M", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"-", "isite"}], "-", "1"}], "]"}], "]"}]}], "]"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "6"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"R", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{"R", ",", "mpo"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "6"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"3", ",", "8"}], "}"}]}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"R", "=", 
          RowBox[{"Activate", " ", "@", " ", 
           RowBox[{"TensorContract", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
              RowBox[{"R", ",", 
               RowBox[{"Conjugate", "[", 
                RowBox[{"M", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"-", "isite"}], "-", "1"}], "]"}], "]"}], "]"}]}], 
              "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "7"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"4", ",", "5"}], "}"}]}], "}"}]}], "]"}]}]}]}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"isite", ",", "2", ",", 
          RowBox[{
           RowBox[{"NN", "/", "2"}], "-", "1"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"M", "[", 
        RowBox[{"[", 
         RowBox[{"NN", "/", "2"}], "]"}], "]"}], "=", 
       RowBox[{"Activate", " ", "@", " ", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{
            RowBox[{"M", "[", 
             RowBox[{"[", 
              RowBox[{"NN", "/", "2"}], "]"}], "]"}], ",", 
            RowBox[{"SS", "[", 
             RowBox[{"[", 
              RowBox[{"NN", "/", "2"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"EGS", ",", "M"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.672194682518838*^9, 3.672194690332431*^9}, {
   3.6721948481199427`*^9, 3.672194968139052*^9}, {3.67219507644308*^9, 
   3.672195141577938*^9}, {3.672195272779244*^9, 3.672195324006905*^9}, {
   3.672195497125247*^9, 3.672195528477317*^9}, {3.672195559683247*^9, 
   3.672195703050281*^9}, 3.6721958059720993`*^9, {3.672196300392621*^9, 
   3.6721963473151627`*^9}, {3.672196406096291*^9, 3.672196439734705*^9}, {
   3.672196476499881*^9, 3.672196516127323*^9}, {3.6721978388883467`*^9, 
   3.672197861305253*^9}, {3.6721978987676163`*^9, 3.67219790349321*^9}, {
   3.6721979351330767`*^9, 3.672198124658815*^9}, {3.672198200317038*^9, 
   3.6721982525495043`*^9}, {3.672198342968124*^9, 3.6721984678988113`*^9}, {
   3.672198501783999*^9, 3.6721985031230087`*^9}, {3.6721985488027077`*^9, 
   3.672198564484007*^9}, {3.672198596781044*^9, 3.672198649973771*^9}, {
   3.672198687029813*^9, 3.6721987465866823`*^9}, {3.672198789802136*^9, 
   3.672198901917989*^9}, {3.6721989385706053`*^9, 3.6721989487622757`*^9}, {
   3.672199741368142*^9, 3.672199875274222*^9}, {3.672199950223487*^9, 
   3.6721999678527822`*^9}, {3.672200140957391*^9, 3.672200161957451*^9}, {
   3.672200216442357*^9, 3.672200220270811*^9}, {3.6722002728867826`*^9, 
   3.672200279385954*^9}, {3.6722003118458557`*^9, 3.672200333156446*^9}, {
   3.672200379542894*^9, 3.6722004317843323`*^9}, {3.6722004881358747`*^9, 
   3.672200564882084*^9}, {3.672200642924687*^9, 3.6722006846278763`*^9}, {
   3.672200726490244*^9, 3.672200734162498*^9}, {3.6722008170098343`*^9, 
   3.6722008400147963`*^9}, {3.672200912151956*^9, 3.6722009171015778`*^9}, {
   3.672200970717785*^9, 3.672200986544587*^9}, {3.672201102099016*^9, 
   3.6722011228411016`*^9}, {3.672201168496482*^9, 3.672201174267179*^9}, {
   3.672201208961713*^9, 3.672201212834744*^9}, {3.67220256504635*^9, 
   3.672202670886725*^9}, {3.6722027024085493`*^9, 3.6722027258087597`*^9}, {
   3.672202921932706*^9, 3.6722029345210447`*^9}, {3.6722030028330803`*^9, 
   3.672203054334524*^9}, {3.6722031003936243`*^9, 3.672203139802527*^9}, {
   3.672203170922205*^9, 3.672203172788228*^9}, {3.6722032149342422`*^9, 
   3.672203230760516*^9}, {3.6722033402447166`*^9, 3.672203392050252*^9}, {
   3.672203434138447*^9, 3.6722035120334682`*^9}, {3.6722043462275248`*^9, 
   3.6722044589851503`*^9}, {3.672204866464006*^9, 3.672204912712957*^9}, {
   3.672204990316688*^9, 3.6722050515608253`*^9}, {3.67220536368499*^9, 
   3.672205388331695*^9}, {3.672205456924877*^9, 3.6722054710650263`*^9}, {
   3.672205599892036*^9, 3.672205729965106*^9}, {3.672205888180224*^9, 
   3.672206020126815*^9}, {3.6722060543181973`*^9, 3.672206054485784*^9}, {
   3.672206203382124*^9, 3.6722062208051443`*^9}, {3.6722062759669847`*^9, 
   3.672206278264702*^9}, {3.672206329022922*^9, 3.672206329173111*^9}, {
   3.6722064728529997`*^9, 3.672206492573187*^9}, {3.672206621309991*^9, 
   3.6722066302304*^9}, {3.672206696191122*^9, 3.6722067613374987`*^9}, {
   3.672206917417391*^9, 3.6722069450965*^9}, {3.672206976890174*^9, 
   3.6722070215082684`*^9}, {3.672207058019327*^9, 3.672207187234725*^9}, {
   3.672207258888307*^9, 3.672207261485526*^9}, {3.672207297588032*^9, 
   3.672207326726256*^9}, {3.672207369277442*^9, 3.672207373708946*^9}, {
   3.672207564597617*^9, 3.672207602528665*^9}, {3.672207699912738*^9, 
   3.672207705739539*^9}, {3.672207738232916*^9, 3.672207793231914*^9}, {
   3.672207920867201*^9, 3.67220793246237*^9}, 3.672207993126062*^9, 
   3.672208070435916*^9, 3.67220819121728*^9, {3.672226704791614*^9, 
   3.672226712474154*^9}, {3.672227469840702*^9, 3.672227480279935*^9}, {
   3.672227820663148*^9, 3.672227888008875*^9}, {3.672228170124311*^9, 
   3.6722281752097588`*^9}, {3.67226184597791*^9, 3.6722619041171722`*^9}, {
   3.672265143430832*^9, 3.672265243586938*^9}, {3.672265359576909*^9, 
   3.672265386552443*^9}, {3.672265418470687*^9, 3.672265429076356*^9}, {
   3.6722674923814163`*^9, 3.672267614000918*^9}, {3.6722676551313*^9, 
   3.672267743092169*^9}, {3.672267790427198*^9, 3.672267811001985*^9}, {
   3.672267844246125*^9, 3.6722678503300123`*^9}, {3.67226809588798*^9, 
   3.672268099171852*^9}, {3.672268172192127*^9, 3.672268191927847*^9}, {
   3.672268228290326*^9, 3.672268235566931*^9}, {3.672268501861229*^9, 
   3.672268576715035*^9}, {3.672268616641151*^9, 3.672268616836749*^9}, {
   3.672268679907164*^9, 3.672268772730501*^9}, {3.672268849463208*^9, 
   3.672268856200766*^9}, {3.67226892189005*^9, 3.672268924072288*^9}, {
   3.672268958565456*^9, 3.672268960264201*^9}, {3.6722689917433767`*^9, 
   3.672269010744121*^9}, {3.672269294344801*^9, 3.6722693273988523`*^9}, {
   3.6722693860466423`*^9, 3.6722694202443123`*^9}, {3.672269467376466*^9, 
   3.6722694705228167`*^9}, {3.6722715428152647`*^9, 3.672271547442575*^9}, 
   3.672271586967119*^9, {3.672271709678857*^9, 3.672271739389533*^9}, {
   3.672271797384038*^9, 3.6722718509135*^9}, {3.672272655532535*^9, 
   3.672272736664794*^9}, 3.672272780115643*^9, {3.672272868698633*^9, 
   3.67227287026223*^9}, {3.6722730868284817`*^9, 3.67227310822256*^9}, 
   3.672273414191523*^9, {3.672273571929289*^9, 3.672273575402649*^9}, {
   3.672277101234929*^9, 3.672277105428217*^9}, {3.674083040887268*^9, 
   3.6740830415349045`*^9}, 3.6741009524843674`*^9, {3.6749712533177876`*^9, 
   3.6749712608753395`*^9}, 3.6749712944149203`*^9, {3.6749716803126974`*^9, 
   3.6749717536126995`*^9}, {3.6749717875368185`*^9, 3.674971789902526*^9}, {
   3.6749718236005363`*^9, 3.674971825842032*^9}, 3.674971979664458*^9, {
   3.674972075286233*^9, 3.674972101414254*^9}, 3.6749721446523457`*^9, {
   3.6749722654931073`*^9, 3.6749722699804955`*^9}, 3.674972354130763*^9, 
   3.674972447175418*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Functions", "Title",
 CellChangeTimes->{{3.672273693348484*^9, 3.672273731856269*^9}, {
  3.7146444741909857`*^9, 3.714644474485941*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "calculate", " ", "single", " ", "site", " ", "operator", " ", 
     "expection", " ", "value"}], ",", 
    RowBox[{
     RowBox[{
     "Ml", " ", "is", " ", "the", " ", "center", " ", "tensor", " ", "which", 
      " ", "means", " ", "all", " ", 
      RowBox[{"left", "/", "right"}], " ", "tensors", " ", "are", " ", 
      RowBox[{"left", "/", "right"}]}], "-", "normalized"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"opexpval", "[", 
      RowBox[{"Ml_", ",", "op_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "expectvalue", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"expectvalue", "=", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"op", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "*", 
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Ml", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "\[HermitianConjugate]"}], 
              ".", 
              RowBox[{"Ml", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "d"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "expectvalue", "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "two", " ", "sites", " ", "with", " ", "opi", " ", "at", " ", "position",
       " ", "i", " ", "and", " ", "opj", " ", "at", " ", "position", " ", 
      "j"}], ",", " ", 
     RowBox[{
     "center", " ", "tnesor", " ", "at", " ", "position", " ", "i"}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"opexpval2", "[", 
      RowBox[{"mps_", ",", "opi_", ",", "opj_", ",", "i_", ",", "j_"}], "]"}],
      ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"expectvalue", ",", "L", ",", "R", ",", "Midd", ",", "REnd"}],
         "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"expectvalue", "=", 
         RowBox[{"Activate", " ", "@", " ", 
          RowBox[{"TensorContract", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
             RowBox[{
              RowBox[{"mps", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", "opi"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "5"}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"expectvalue", "=", 
         RowBox[{"Activate", " ", "@", " ", 
          RowBox[{"TensorContract", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
             RowBox[{"expectvalue", ",", 
              RowBox[{"Conjugate", "[", 
               RowBox[{"mps", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"expectvalue", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"expectvalue", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "3", ",", "2", ",", "4"}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Midd", "=", 
            RowBox[{"Activate", " ", "@", " ", 
             RowBox[{"TensorContract", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                RowBox[{
                 RowBox[{"mps", "[", 
                  RowBox[{"[", "k", "]"}], "]"}], ",", 
                 RowBox[{"Conjugate", "[", 
                  RowBox[{"mps", "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"expectvalue", "=", 
            RowBox[{"Activate", " ", "@", " ", 
             RowBox[{"TensorContract", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
                RowBox[{"expectvalue", ",", "Midd"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"3", ",", "5"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"4", ",", "7"}], "}"}]}], "}"}]}], "]"}]}]}], ";"}],
           "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", 
            RowBox[{"i", "+", "1"}], ",", 
            RowBox[{"j", "-", "1"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"REnd", "=", 
         RowBox[{"Activate", " ", "@", " ", 
          RowBox[{"TensorContract", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
             RowBox[{
              RowBox[{"mps", "[", 
               RowBox[{"[", "j", "]"}], "]"}], ",", "opj"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "5"}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"REnd", "=", 
         RowBox[{"Activate", " ", "@", " ", 
          RowBox[{"TensorContract", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
             RowBox[{"REnd", ",", 
              RowBox[{"Conjugate", "[", 
               RowBox[{"mps", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", "4"}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"expectvalue", "=", 
         RowBox[{"Activate", " ", "@", " ", 
          RowBox[{"TensorContract", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
             RowBox[{"expectvalue", ",", "REnd"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"3", ",", "5"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"4", ",", "7"}], "}"}]}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"L", "=", 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{
           RowBox[{"Dimensions", "[", "expectvalue", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"R", "=", 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{
           RowBox[{"Dimensions", "[", "REnd", "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"expectvalue", "=", 
         RowBox[{"Activate", " ", "@", " ", 
          RowBox[{"TensorContract", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
             RowBox[{"L", ",", "expectvalue"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"2", ",", "4"}], "}"}]}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"expectvalue", "=", 
         RowBox[{"Activate", " ", "@", " ", 
          RowBox[{"TensorContract", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
             RowBox[{"expectvalue", ",", "R"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", "3"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"2", ",", "4"}], "}"}]}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "expectvalue", "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwdzltMEmAABWAiYeV4QQlL0OwGq7VhzYa18cCGQrPU0Ra6JWZ2YQ5spc22
XM1CdFZb+EA2VsuiNReuknVZZFqWBDVXamAgSIlTQ5uAZVys/sPD2fdytnM2
HDkpP0alUCgCEvg39XxN8aGgeHmT4wyUJA7bS4iWNpETrt1Y6oHDptEAfCPu
mYEtA/pZ2NUZ/lhK5FVHkzJ0Ek2c+IIdq4P1Zqb2Q2VQbM/bcRnKVmyu+k2s
/2FUQWWUroHF1IykZaL+U1B1Vt8A99B7z8ESzeomKK5W6qC98N4VqBhxt8P7
g89uQF2iNwoXnzTEIG/kgS9OnC8qmICtf/rn4eurfWG4EGAvQUO4Jwb5tVJK
gnh72pJU/U5Lg1pZMx06QpkMqKhtY0FfTgoXZm73Z8Fp4yo+fMnp3gb3FWkN
8DPn/XXYOuy/w6wif3+57kLut/wuGHmrt8Bm/4Hn8BOnYhCaDBey0ohP59Zn
Q4PUYU0n6h6WfYW5npQA3O11TkF/lihdRqzhy9fAIdWldZCqVmyBux5lbIUd
LTYBPG3z5cOVwgkJ9AqnmuBYH+0idP60fUn2bvLcsG6A+x1azZOTcFRNnYFy
ZWIWHm88GoKycm8EmtnjS3CB8TgOpQXOf/DazvGkpk5ayl5iXDiXBoeNVgFU
5TBz4au8CRHcfyJDDlNZYwfhQIeuErItQ87s7qA4pva4YHsk3V0YIruNnknI
WnYtwvKKW1Qp8T+Aio2A
  "]]
}, Closed]],

Cell[CellGroupData[{

Cell["Main", "Title",
 CellChangeTimes->{{3.6721946724367332`*^9, 3.672194673368575*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"PhysRevA", ".8", ".022108"}], ",", " ", 
    RowBox[{"h", "=", 
     RowBox[{"g", "/", "2"}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"MPO", "[", 
      RowBox[{"h_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"isingMPO", "[", 
      RowBox[{"h", ",", "n"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"h1", "[", "h_", "]"}], ":=", 
     RowBox[{"isingh1", "[", "h", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"J", "=", "1."}], ";", 
    RowBox[{"NN", "=", "100"}], ";", 
    RowBox[{"DD", "=", "10"}], ";", 
    RowBox[{"d", "=", 
     RowBox[{
      RowBox[{"Dimensions", "[", 
       RowBox[{"MPO", "[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}], "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], ";", 
    RowBox[{"sweep", "=", "6"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sites", "=", "60"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sz", "=", 
     RowBox[{"Table", "[", 
      RowBox[{"Null", ",", 
       RowBox[{"{", "sites", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sxx", "=", 
     RowBox[{"Table", "[", 
      RowBox[{"Null", ",", 
       RowBox[{"{", "sites", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"expsz", "=", 
        RowBox[{"fDMRG", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"ii", "-", "1"}], ")"}], "/", "50."}], ",", "1", ",", 
          "True"}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ii", "\[Equal]", "3"}], ",", 
           RowBox[{"Print", "[", "szs", "]"}]}], "]"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sz", "[", 
         RowBox[{"[", "ii", "]"}], "]"}], "=", 
        RowBox[{"Mean", "[", 
         RowBox[{"expsz", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sxx", "[", 
         RowBox[{"[", "ii", "]"}], "]"}], "=", 
        RowBox[{"Mean", "[", 
         RowBox[{"expsz", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ii", ",", "1", ",", "sites"}], "}"}]}], "]"}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.6751222490362997`*^9, 3.6751223344295216`*^9}, {
   3.6751223659640727`*^9, 3.6751223672824316`*^9}, {3.675122432707876*^9, 
   3.675122434695826*^9}, {3.675122467905692*^9, 3.6751225582633276`*^9}, {
   3.675125837835746*^9, 3.6751258652927237`*^9}, {3.675125914236112*^9, 
   3.6751259491348553`*^9}, {3.675126458803336*^9, 3.6751264631738253`*^9}, 
   3.6751396661126366`*^9, {3.6751398088940315`*^9, 3.675139811253074*^9}, {
   3.71464311188556*^9, 3.714643118892517*^9}, {3.714643493372099*^9, 
   3.714643495037158*^9}, {3.714643582731855*^9, 3.7146435908093863`*^9}, {
   3.714643825034988*^9, 3.7146438481199427`*^9}, {3.714644324500778*^9, 
   3.714644352693345*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"szplot", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"ii", "/", "50."}], "-", 
        RowBox[{"1", "/", "50."}]}], ",", 
       RowBox[{"sz", "[", 
        RowBox[{"[", "ii", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ii", ",", "1", ",", "sites"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sxxplot", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"ii", "/", "50."}], "-", 
        RowBox[{"1", "/", "50."}]}], ",", 
       RowBox[{"sxx", "[", 
        RowBox[{"[", "ii", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ii", ",", "1", ",", "sites"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListLinePlot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"szplot", ",", "sxxplot"}], "}"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.714644132498281*^9, 3.714644242814014*^9}, {
  3.714644365160939*^9, 3.71464437277423*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, {}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.01388888888888889], 
     AbsoluteThickness[1.6], LineBox[CompressedData["
1:eJwtk3tIU2EYxldkhO0vNYlQu0C12EpI1LLJ08VKzbwVVM5IwklZaRe6qE3T
shZdrLSb+IexEVE5/8himmiaJcmMyVbmtW1edradc5o689J1+/a9cDi8nO97
3vf3PJzlh3NT5XMFAoHU/XjeRcb7dQk6naclVRCg2WnOr0DCqjSxcbgC+aRX
I39GuDWIUUMbUupI0WrwT/Ns5khmLbzn61C198aobLIOj0nV48/bm+dj0YB6
cr4J5WtrfxvvNoNN8Si0IH6La6nifCu93waVJbHjmOQDFnarTkb7tsMvJr9s
kGlHJdH7BJfWIg3SdGBNelnrpEiH3f5/k+4pOqn+ZxTEX3mUK9FD7b7drdKj
5P4mw4/qLjjIvC5M9PnlZQQbEEbKgNuvAnmhykjnG/Ems3PdtbCvcIu7J3zB
gkhJUKu+G75kn24E75zDbFT0IJUY8A3+84cV4dI+ytsD2eCJ4ki/AZiJYb3I
9G3aYPD5Tvfth/plh6D+jglkvZMDEB+3RUU0mqmfg1BtvF5+dsUQvCmYsOPJ
5UIhM0x5TLhY2GZSJo8i1jsAzytetzxPs1I+M3Qj86rSQxmUEQALGg+8FIea
GMo7hPE4RaT6nA1enCGc6Vvmqpu2Uf5hRGwuWZmXbcdSzzohI2gWiP9aP9vx
nvgxglhZ0qVokQNZpEZxbnHb5vALDuqPFdKAwql17xzwqAVorKic2F28Yw5L
/WIQ5adMypSy+OmRm2RQMfe3b9xpluZrQ1ffw4UPVCyIPdF2XEn0eWrQs9RP
O5b0SlxnZ1mUeoGxXdJfalrGUX9ZyNfPbDsaw6FT5ykWCfbQhjQ5h1NEkIPc
EsxOXuZAcAN41Ozp1Z+p5qj/7j6pVjn/LQcil/4D8rABWa+Bo3k4UTT94lag
g6M8TmzR5goHBTzNx4kPB8N9khfxlM+JQzn7M5QinuY1himNSFwdxVPeMeTs
48dqdvH0f3B/z3IJP8p4yj+Ozn1NltlsnuY5jmDn6uUH83jqxzgWNPfzv67y
+A+6f+RV
      "]]}, 
    {RGBColor[0.880722, 0.611041, 0.142051], PointSize[0.01388888888888889], 
     AbsoluteThickness[1.6], LineBox[CompressedData["
1:eJxVk2tIU2EYxzcvSJPsggomaOtCml0J0bz0T4NcEqhFIml+MJVGqKukvKQo
ZJagfrCVF1Rskhk2P6SpiY6Wd6fOW1NT20W3uc2dKSgWRbnXtw89cDgceM//
eX6/h5ebkHYtyYbFYgVtP9b3/2VBtrM4TJX1AshOSK/9xSCLfNej+1Ld66x1
Bu0eBcaodjFKei+sFqoYer4Fwmxbl7ZBBhWkOsBRTiot7xh0kPPdiB2YqHIt
YGCKsiZ8Bl9cncCO+fd/Dx4GevnmH2bgqBAJgjn9SK0O6Y7VmVFJ8gaRIXzU
GS4ywzuuVLrhJYO8ckj7I9pM80fB3+rytbMxo377b4VIDkVfj49FtAoj6TeO
odyqb8eDVnGO1CQu1XN+soZMtP8UFOkONsKrJmyHb3eYBvtmW5tcagSHzKPA
rpQGdoSPEdeIgBk0+TVG+D8xUN5ZPM5rrLAfXoGKCJsDz0kncPqlp/PO45Pd
yw/l+/Qg4wkWcFBux/Vl66jPRXxM8XSRNC1jZw9KRN/nLzQaNZRHiSNNoZLm
DDV4Ow1wrDUyZTNWRflU0HC6TvWnKVFKANSI6Ntz/hnvO+XVYPfB2Bh79QJ2
cDQYKHWYKaubp/xL6GKOylzzvsHTOo7HMpo3DgTdyZjDF+JjGfEL6lv1T2eR
TEoL2weJGdKGGepHB4Ojfc2NWQWsac5iHXxz39bedlNQX3rExEf5XUn+ik1r
3IYevcmtmW+6p+l+V/Bc2NkcyZ0G0RNsQKB+SxFWPEV9GrA/8XSLmD2Fgh1g
/Nlb/rYnZ5L6NSHg4mVGyZrEiMxaJoR5igZSiyZwjwSuwvuZ4K7BbQIE19kM
YYO2cFE8Tv2bcYQbEazmjYPExTEY+j3Mf6WT49+98Ge0IY1FcspjQc2JKe7w
WTndjwVRxWz3tI4xymcBX9/7Pt51jO5rDdn5lf1rmaOUdw0BYf3uEs0IvQ9r
WCqTnEm+PkL515FTwROUDMjoPteRtFkYrQ2VUR/rOFkZ3nlIOoy/PAjhuQ==

      "]]}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0, 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{0, 1}, {0, 1}},
  PlotRangeClipping->True,
  PlotRangePadding->{{0, 0}, {0, 0}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{3.714644122539961*^9, 3.714644244157564*^9, 
  3.714644373534749*^9}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1264, 701},
WindowMargins->{{-1623, Automatic}, {-122, Automatic}},
CellContext->Notebook,
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 203, 3, 92, "Title"],
Cell[786, 27, 24754, 532, 1403, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[25577, 564, 160, 2, 66, "Title"],
Cell[25740, 568, 46449, 1036, 2553, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[72226, 1609, 90, 1, 92, "Title"],
Cell[72319, 1612, 36860, 873, 2049, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[109216, 2490, 143, 2, 66, "Title"],
Cell[109362, 2494, 9272, 229, 558, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[118671, 2728, 89, 1, 66, "Title"],
Cell[118763, 2731, 3146, 83, 222, "Input"],
Cell[CellGroupData[{
Cell[121934, 2818, 1285, 41, 75, "Input"],
Cell[123222, 2861, 3567, 70, 246, "Output"]
}, Open  ]]
}, Open  ]]
}
]
*)

